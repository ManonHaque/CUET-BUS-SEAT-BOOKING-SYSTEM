<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <style>
        *{
            box-sizing: border-box;
        }
        body{
            display: flex;
            justify-content: center;
            align-items: center;
            height: 95vh;
        }
        .container #form{
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .container #form .input{
            height: 5vh;
            width: 20vw;
            background-color: rgb(0, 25, 55);
            color: white;
            padding: 10px;
            border-radius: 5px;
            border: none;
            outline: none;
            font-size: 1rem;
        }
        .container #form .register{
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }
        .container #form .register a{
            text-decoration: none;
            color: rgb(0, 25, 55);

        }  
        .container #form .submit{
            height: 5vh;
            width: 8vw;
            margin: 10px auto ;
            background-color: #162032;
            color: white;
            font-size: 1.2rem;
            outline: none;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }        


    </style>
</head>
<body>
    <div class="container">
        <form action="" id="form">
            <input class="input" type="text" name="Cuet Mail" id="mail" placeholder="Cuet Mail">
            <input class="input" type="text" name="Id" id="id" placeholder="Student Id">
            <input class="input" type="password" name="password" id="password" placeholder="Password">
            <div class="register">
                <a href="">Forget Password</a>
                <a href="Signup.html">Register</a>
            </div>
            <button type="submit" class="submit">Submit</button>
        </form>
    </div>
</body>
<script>
document.getElementById('form').addEventListener('submit', async (e) => {
  e.preventDefault();

  const data = {
    email: document.getElementById('mail').value,
    password: document.getElementById('password').value
  };

  try {
    const response = await fetch('http://localhost:5000/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    const result = await response.json();
    console.log(result);

    if (response.ok) {
      localStorage.setItem('token', result.token);       // ✅ Save token
      localStorage.setItem('user', JSON.stringify(result.user)); // ✅ Save user info
      const role = result.user.role.toLowerCase(); // ✅ FIX HERE
      if (role === 'admin') {
            window.location.href = 'Admin.html';
        } else {
            window.location.href = 'Home.html';
        }               // ✅ Redirect
    } else {
      alert(result.msg || 'Login failed ❌');
    }
  } catch (error) {
    console.error('Fetch error:', error);
    alert('Could not reach server ❌');
  }
});
</script>
</html>